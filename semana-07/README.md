# Semana 7: Testing Avanzado y Performance BÃ¡sica

â° **DURACIÃ“N T### **ğŸ’» PrÃ¡cticas\*\*

1. [ğŸ” Coverage Avanzado y Testing con Mocks](./2-practica/25-coverage-advanced.md) _(90 min)_
2. [ğŸ”´ Redis y Caching BÃ¡sico](./2-practica/26-redis-basic.md) _(60 min)_
3. [ğŸ—ƒï¸ Database Optimization BÃ¡sica](./2-practica/27-database-basic.md) _(60 min)_
4. [ğŸ”§ CI/CD con GitHub Actions](./2-practica/28-cicd-basic.md) _(75 min)_
5. [âœ… ConsolidaciÃ³n y Testing Final](./2-practica/29-final-integration.md) _(45 min)_ HORAS EXACTAS**  
   ğŸ“š **NIVEL: Intermedio-Avanzado (construye sobre Semanas 1-6)\*\*

## ğŸš¨ **IMPORTANTE: Testing + Performance BÃ¡sica**

Esta semana estÃ¡ diseÃ±ada para estudiantes que **ya tienen una API completa con autenticaciÃ³n, roles y testing bÃ¡sico** (Semanas 1-6). Implementaremos testing avanzado con coverage y optimizaciones bÃ¡sicas de performance.

- âœ… **Completamente realizable en 6 horas**
- âœ… **Enfoque prÃ¡ctico en testing robusto + performance**
- âœ… **PreparaciÃ³n para CI/CD y producciÃ³n bÃ¡sica**

## ğŸ¯ Objetivos de la Semana AJUSTADOS (Fundamentales)

Al finalizar esta semana de 5h 30min efectivos (incluye break de 30 min), los estudiantes:

1. âœ… **ImplementarÃ¡n coverage avanzado** con reportes detallados
2. âœ… **ConfigurarÃ¡n CI/CD bÃ¡sico** con GitHub Actions
3. âœ… **AplicarÃ¡n caching bÃ¡sico** con Redis para consultas frecuentes
4. âœ… **OptimizarÃ¡n consultas** de base de datos con Ã­ndices bÃ¡sicos
5. âœ… **ConsolidarÃ¡n sistema completo** con testing y performance

### âŒ **Lo que NO se espera dominar esta semana** (MOVIDO A SEMANA 8)

- ~~Middleware personalizado avanzado~~ â†’ **Semana 8**
- ~~Rate limiting complejo~~ â†’ **Semana 8**
- ~~Monitoring avanzado con mÃ©tricas~~ â†’ **Semana 8**
- ~~Profiling de performance complejo~~ â†’ **Semana 8**
- Microservicios y arquitectura distribuida
- Clusters de Redis y alta disponibilidad

## â±ï¸ DistribuciÃ³n de Tiempo AJUSTADA (5h 30min efectivos)

| Bloque | Actividad                   | Tiempo | DescripciÃ³n                                 |
| ------ | --------------------------- | ------ | ------------------------------------------- |
| **1**  | Coverage y Testing Avanzado | 90 min | Coverage reports, mocks, fixtures avanzadas |
| **2**  | Redis y Caching BÃ¡sico      | 60 min | Redis setup, cache patterns bÃ¡sicos         |
| **3**  | Database Optimization       | 60 min | Ãndices bÃ¡sicos, EXPLAIN, connection pool   |
| **4**  | CI/CD IntroducciÃ³n          | 75 min | GitHub Actions, testing automÃ¡tico          |
| **5**  | ConsolidaciÃ³n Final         | 45 min | Testing completo, debugging, documentaciÃ³n  |

**CAMBIOS PRINCIPALES:**

- âœ… **Agregado**: Coverage avanzado y testing con mocks (desde Semana 6)
- âœ… **Agregado**: CI/CD bÃ¡sico con GitHub Actions
- â¬‡ï¸ **Reducido**: Redis de 90 a 60 minutos (solo bÃ¡sico)
- â¬‡ï¸ **Reducido**: Database optimization de 90 a 60 minutos
- âŒ **Eliminado**: Middleware avanzado (se mueve a Semana 8)
- âŒ **Eliminado**: Monitoring complejo (se mueve a Semana 8)

## ğŸ“š Contenido de la Semana

### **ğŸ“‹ NavegaciÃ³n Ordenada (Seguir este orden)**

1. **[ğŸ§­ 1-teoria/](./1-teoria/)** - Conceptos de performance y optimizaciÃ³n
2. **[ğŸ’» 2-practica/](./2-practica/)** - ImplementaciÃ³n de optimizaciones
3. **[ğŸ¯ 3-ejercicios/](./3-ejercicios/)** - Ejercicios de performance
4. **[ğŸš€ 4-proyecto/](./4-proyecto/)** - API optimizada para producciÃ³n
5. **[ğŸ“š 5-recursos/](./5-recursos/)** - Referencias y herramientas

### **ğŸ§­ TeorÃ­a**

- [âš¡ Performance y OptimizaciÃ³n en APIs](./1-teoria/performance-concepts.md)

### **ğŸ’» PrÃ¡cticas**

1. [ï¿½ Coverage Avanzado y Testing con Mocks](./2-practica/25-coverage-advanced.md) _(90 min)_
2. [ï¿½ğŸ”´ Redis y Caching BÃ¡sico](./2-practica/26-redis-basic.md) _(60 min)_
3. [ğŸ—ƒï¸ Database Optimization BÃ¡sica](./2-practica/27-database-basic.md) _(60 min)_
4. [ï¿½ CI/CD con GitHub Actions](./2-practica/28-cicd-basic.md) _(75 min)_
5. [ï¿½ ConsolidaciÃ³n y Testing Final](./2-practica/29-final-integration.md) _(45 min)_

**ELIMINADO/MOVIDO A SEMANA 8:**

- ~~Middleware personalizado~~ â†’ **Semana 8**
- ~~Rate limiting avanzado~~ â†’ **Semana 8**
- ~~Monitoring y profiling~~ â†’ **Semana 8**

### **ğŸ’ª Ejercicios**

- [ğŸ¯ Ejercicios de OptimizaciÃ³n](./3-ejercicios/ejercicios-performance.md)

### **ğŸš€ Proyecto**

- [ğŸª E-commerce High Performance](./4-proyecto/especificacion-performance.md)

### **ğŸ“š Recursos**

- [ğŸ“– Recursos de Performance](./5-recursos/recursos-apoyo.md)

---

## âš¡ TecnologÃ­as de la Semana

### **Stack de Performance**

- **Redis**: Sistema de cache en memoria para optimizaciÃ³n
- **SQLAlchemy Optimizations**: Query optimization y connection pooling
- **Slowapi**: Middleware para rate limiting en FastAPI
- **Uvicorn**: Configuraciones avanzadas del servidor ASGI

### **Herramientas de Monitoring**

- **Python Profilers**: cProfile, py-spy para anÃ¡lisis de performance
- **FastAPI Middleware**: Custom middleware para mÃ©tricas
- **Logging**: Structured logging con loguru
- **Memory Profiling**: memory_profiler para anÃ¡lisis de memoria

### **Database Performance**

- **PostgreSQL Indexes**: OptimizaciÃ³n de consultas con Ã­ndices
- **Connection Pooling**: GestiÃ³n eficiente de conexiones DB
- **Query Analysis**: EXPLAIN y optimizaciÃ³n de queries
- **Async Database Operations**: Operaciones asÃ­ncronas avanzadas

---

## â±ï¸ **Estructura de 6 Horas (Incluye Break de 30 min)**

### **Bloque 1: Coverage y Testing Avanzado (90 min)**

- **25-coverage-advanced.md**
- Coverage reports con HTML/XML
- Testing con mocks y fixtures avanzadas
- IntegraciÃ³n con herramientas de CI

### **Bloque 2: Redis y Caching BÃ¡sico (60 min)**

- **26-redis-basic.md** _(simplificado)_
- InstalaciÃ³n y configuraciÃ³n de Redis
- Cache bÃ¡sico para endpoints crÃ­ticos
- InvalidaciÃ³n simple de cache

### **Bloque 3: Database Optimization BÃ¡sica (60 min)**

- **27-database-basic.md** _(simplificado)_
- AnÃ¡lisis bÃ¡sico con EXPLAIN
- CreaciÃ³n de Ã­ndices estratÃ©gicos bÃ¡sicos
- Connection pooling simple

### **Bloque 4: CI/CD IntroducciÃ³n (75 min)**

- **28-cicd-basic.md** _(nuevo)_
- GitHub Actions workflow bÃ¡sico
- Testing automÃ¡tico en CI
- Deploy concepts fundamentales

---

## ğŸ¯ **Quick Start**

### **Requisitos Previos**

- âœ… **Semanas 1-6 completadas** (API con auth y testing)
- âœ… **PostgreSQL funcionando** correctamente
- âœ… **Docker instalado** para Redis
- âœ… **API base** con usuarios y CRUD implementado

### **Setup RÃ¡pido**

```bash
# 1. Navegar a semana 7
cd semana-07

# 2. Instalar dependencias de performance
pip install redis slowapi loguru memory-profiler py-spy

# 3. Levantar Redis con Docker
docker run -d --name redis-cache -p 6379:6379 redis:alpine

# 4. Verificar conexiÃ³n Redis
python -c "import redis; r=redis.Redis(); print('Redis OK:', r.ping())"

# 5. Empezar con prÃ¡ctica 23
cd 2-practica && cat 23-redis-caching.md
```

## ğŸ“… Cronograma AJUSTADO de la Jornada (5h 30min efectivos)

| Tiempo      | Actividad                   | DuraciÃ³n | Acumulado |
| ----------- | --------------------------- | -------- | --------- |
| 12:00-13:30 | Coverage y Testing Avanzado | 90 min   | 90 min    |
| 13:30-14:00 | **â˜• BREAK OBLIGATORIO**    | 30 min   | 120 min   |
| 14:00-15:00 | Redis y Caching BÃ¡sico      | 60 min   | 180 min   |
| 15:00-16:00 | Database Optimization       | 60 min   | 240 min   |
| 16:00-17:15 | CI/CD con GitHub Actions    | 75 min   | 315 min   |
| 17:15-18:00 | ConsolidaciÃ³n Final         | 45 min   | 360 min   |

**Total**: Exactamente 5h 30min efectivos (330 minutos + 30min break)

---

## ğŸ“Š **MÃ©tricas de Ã‰xito**

### **Performance Targets**

- ğŸ¯ **Response Time**: <200ms para endpoints CRUD bÃ¡sicos
- ğŸ¯ **Cache Hit Ratio**: >80% en endpoints frecuentes
- ğŸ¯ **Memory Usage**: <512MB para aplicaciÃ³n completa
- ğŸ¯ **Database Connections**: Pool eficiente <20 conexiones
- ğŸ¯ **Rate Limiting**: 100 requests/min por usuario

### **Monitoring BÃ¡sico**

- âœ… **Request/Response Logging**: Todas las operaciones
- âœ… **Error Tracking**: 4xx y 5xx responses
- âœ… **Performance Metrics**: Response times por endpoint
- âœ… **Resource Usage**: CPU, Memory, Database connections
- âœ… **Cache Metrics**: Hit ratio, miss ratio, invalidations

---

## ğŸ’¡ **Tips para el Ã‰xito**

### **Enfoque PragmÃ¡tico**

1. **Mide antes de optimizar** - Profile first, optimize second
2. **80/20 Rule** - EnfÃ³cate en las optimizaciones que mÃ¡s impacto tienen
3. **Cache inteligentemente** - No todo necesita cache
4. **Monitor en tiempo real** - MÃ©tricas deben ser visible y actionable

### **Mejores PrÃ¡cticas**

1. **Graceful Degradation** - App funciona sin cache/Redis
2. **Cache Invalidation** - Estrategia clara para mantener consistencia
3. **Rate Limiting Justo** - No bloquear usuarios legÃ­timos
4. **Logging Estructurado** - JSON logs para anÃ¡lisis posterior

### **Evitar Sobre-optimizaciÃ³n**

1. **Optimizar solo bottlenecks reales** identificados por profiling
2. **Mantener cÃ³digo legible** - Performance no debe sacrificar claridad
3. **Testing de performance** - Verificar mejoras con datos
4. **Documentar optimizaciones** - Explicar por quÃ© y cÃ³mo

---

## ğŸ”§ **ConfiguraciÃ³n de Herramientas**

### **Redis Configuration**

```bash
# ProducciÃ³n con persistencia
docker run -d --name redis-prod \
  -p 6379:6379 \
  -v redis_data:/data \
  redis:alpine redis-server --appendonly yes
```

### **PostgreSQL Optimization**

```sql
-- Configuraciones bÃ¡sicas para performance
ALTER SYSTEM SET shared_buffers = '256MB';
ALTER SYSTEM SET effective_cache_size = '1GB';
ALTER SYSTEM SET maintenance_work_mem = '64MB';
SELECT pg_reload_conf();
```

### **FastAPI Performance Settings**

```python
# uvicorn con optimizaciones
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4 --access-log
```

---

## ğŸš¨ **Consideraciones Importantes**

### **Production Readiness**

- âš ï¸ **Cache Failures**: App debe funcionar sin Redis
- âš ï¸ **Rate Limiting**: Configurar lÃ­mites apropiados
- âš ï¸ **Memory Leaks**: Monitor memory usage continuamente
- âš ï¸ **Database Connections**: Evitar connection pool exhaustion

### **Security**

- ğŸ”’ **Redis Security**: Configurar auth si estÃ¡ expuesto
- ğŸ”’ **Rate Limiting Bypass**: Evitar bypass con headers
- ğŸ”’ **Log Sanitization**: No loggear informaciÃ³n sensible
- ğŸ”’ **Error Information**: No exponer detalles internos

### **Scalability**

- ğŸ“ˆ **Horizontal Scaling**: Preparar para mÃºltiples instancias
- ğŸ“ˆ **Database Scaling**: Read replicas consideration
- ğŸ“ˆ **Cache Distribution**: Redis Cluster para escala mayor
- ğŸ“ˆ **Stateless Design**: App debe ser stateless

---

## ğŸ“ **Criterios de EvaluaciÃ³n**

### **Performance (40%)**

- Cache implementation funcionando correctamente
- Database queries optimizadas
- Response times mejorados vs baseline
- Memory usage controlado

### **Monitoring (30%)**

- Logging estructurado implementado
- MÃ©tricas bÃ¡sicas capturadas
- Profiling realizado y documentado
- Rate limiting funcionando

### **CÃ³digo (30%)**

- Middleware implementado correctamente
- Error handling para cache failures
- ConfiguraciÃ³n externalizada
- DocumentaciÃ³n de optimizaciones

---

Â¡PrepÃ¡rate para llevar tu API FastAPI al siguiente nivel de performance! âš¡ğŸš€
